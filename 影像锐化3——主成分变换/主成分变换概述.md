# 主成分变换（PCA）在影像融合中的应用

## 1. 基本思想

主成分分析（Principal Component Analysis, PCA）是一种常用的数据降维和特征提取方法。在遥感影像融合（Pan-sharpening 或空间增强）中，PCA 的核心思想是将多光谱影像波段转换到主成分空间，将高分辨率全色影像（PAN）替换主成分中的第一主成分（通常包含最主要的空间信息），然后再将数据反变换回原始波段，从而实现增强空间分辨率的目的。  

---

## 2. 基本步骤

1. **多光谱波段标准化**  
   对输入的多光谱波段进行均值中心化或标准化处理，使各波段具有相似的量纲，便于计算协方差矩阵。  

2. **计算主成分**  
   通过 PCA 方法计算多光谱波段的协方差矩阵并求解特征值和特征向量，将原始波段投影到主成分空间。第一主成分通常包含影像的主要空间信息。  

3. **用全色影像替换第一主成分**  
   将高分辨率全色影像替换原始主成分空间的第一主成分，以增强空间分辨率。  

4. **反变换回多光谱空间**  
   使用 PCA 逆变换将修改后的主成分重新映射回原始波段空间，得到融合后的高分辨率多光谱影像。  

---

## 3. Python 模拟示例（3×3矩阵）

```python
import numpy as np

# 模拟3x3多光谱影像（R,G,B波段）
R = np.array([[50, 80, 60],
              [70, 60, 90],
              [30, 50, 40]], dtype=float)

G = np.array([[40, 60, 50],
              [60, 50, 80],
              [20, 40, 30]], dtype=float)

B = np.array([[30, 50, 40],
              [50, 40, 70],
              [10, 30, 20]], dtype=float)

# 模拟高分辨率全色影像
PAN = np.array([[200, 220, 210],
                [180, 200, 190],
                [150, 170, 160]], dtype=float)

# 将3个波段展平
X = np.stack([R.flatten(), G.flatten(), B.flatten()]).T

# Step 1: PCA
X_mean = X.mean(axis=0)
X_centered = X - X_mean
cov = np.cov(X_centered, rowvar=False)
eigvals, eigvecs = np.linalg.eigh(cov)
# 按特征值降序排序
idx = np.argsort(eigvals)[::-1]
eigvecs = eigvecs[:, idx]

# Step 2: 投影到主成分空间
PC = X_centered.dot(eigvecs)

# Step 3: 用全色影像替换第一主成分
PC[:, 0] = PAN.flatten() - PAN.flatten().mean() + PC[:,0].mean()  # 保持均值

# Step 4: 逆变换回RGB
X_fused = PC.dot(eigvecs.T) + X_mean
R_fused = X_fused[:,0].reshape(3,3)
G_fused = X_fused[:,1].reshape(3,3)
B_fused = X_fused[:,2].reshape(3,3)

print("融合后的 R 波段:\n", R_fused)
print("融合后的 G 波段:\n", G_fused)
print("融合后的 B 波段:\n", B_fused)

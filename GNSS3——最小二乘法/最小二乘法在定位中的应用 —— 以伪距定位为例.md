# 最小二乘法在定位中的应用 —— 以伪距定位为例

我们将依次回答下面的问题：

## 1. 伪距观测方程

在 GNSS 定位中，接收机到卫星的观测值称为**伪距 (pseudorange)**，其基本观测方程为：

$$
\rho_i = \sqrt{(x - x_i)^2 + (y - y_i)^2 + (z - z_i)^2} + c \cdot \delta t + \varepsilon_i
$$

其中：  
- $\rho_i$ 为第 $i$ 颗卫星的观测伪距；  
- $(x, y, z)$ 为接收机坐标；  
- $(x_i, y_i, z_i)$ 为第 $i$ 颗卫星的坐标（已知）；  
- $c$ 为光速；  
- $\delta t$ 为接收机钟差；  
- $\varepsilon_i$ 为观测误差。  

该方程是**非线性**的。

---

## 2. 牛顿迭代法

由于观测方程是非线性的，不能直接解算。常见做法是采用**牛顿迭代法**：

1. 选取一个接收机坐标的**初始值** $(x^{(0)}, y^{(0)}, z^{(0)}, \delta t^{(0)})$；  
2. 将非线性方程在初始点附近展开，用**一阶泰勒展开**近似；  
3. 将问题转换为线性方程组。

对第 $i$ 颗卫星，线性化的观测方程为：

$$
v_i = \rho_i - \hat{\rho}_i \approx -\frac{x - x_i}{\hat{\rho}_i} \Delta x - \frac{y - y_i}{\hat{\rho}_i} \Delta y - \frac{z - z_i}{\hat{\rho}_i} \Delta z + c \Delta \delta t
$$

其中：  
- $\hat{\rho}_i$ 是用当前迭代解计算的几何距离；  
- $(\Delta x, \Delta y, \Delta z, \Delta \delta t)$ 是本次迭代的改正数。  

---

## 3. 基于最小二乘法解方程

将所有卫星的线性化方程写成矩阵形式：

$$
v = A \Delta X - L
$$

其中：  
- $v$ 为残差向量；  
- $A$ 为设计矩阵，其第 $i$ 行为：

$$
A_i = \left[ -\frac{x - x_i}{\hat{\rho}_i}, -\frac{y - y_i}{\hat{\rho}_i}, -\frac{z - z_i}{\hat{\rho}_i}, c \right]
$$

- $\Delta X = (\Delta x, \Delta y, \Delta z, \Delta \delta t)^T$；  
- $L = (\rho_i - \hat{\rho}_i)^T$ 为观测值与计算值的差。

最小二乘解满足：

$$
\Delta \hat{X} = (A^T A)^{-1} A^T L
$$

更新解：

$$
X^{(k+1)} = X^{(k)} + \Delta \hat{X}
$$

---

## 4. 迭代更新

得到新的解 $X^{(k+1)}$ 后，重复以下步骤：

1. 重新计算几何距离 $\hat{\rho}_i$；  
2. 构建新的设计矩阵 $A$；  
3. 重新计算改正数 $\Delta \hat{X}$；  
4. 更新解。  

直至 $\Delta \hat{X}$ 小于设定的阈值（如 $10^{-4}$ m），则迭代收敛。

---

## 5. 总结

- 伪距观测方程是非线性的，必须采用线性化方法；  
- 牛顿迭代法提供了将非线性方程组转化为线性方程组的手段；  
- 最小二乘法用于解算线性方程组，从而得到接收机坐标与钟差；  
- 通过迭代更新，可以逐步收敛到最优解。  

这一过程是 **GNSS 单点定位 (SPP)** 的基本实现方法。

---
